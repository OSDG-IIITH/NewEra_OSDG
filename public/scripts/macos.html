<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IIIT-H OSDG VPN Setup - macOS</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #0f0f0f 0%, #1a1a2e 100%); color: #e0e0e0; line-height: 1.6; padding: 20px; min-height: 100vh; }
        .container { max-width: 1200px; margin: 0 auto; }
        header { text-align: center; padding: 40px 20px; border-bottom: 2px solid #22d3ee; margin-bottom: 40px; }
        h1 { color: #22d3ee; font-size: 2.5rem; margin-bottom: 10px; }
        .subtitle { color: #a0a0a0; font-size: 1.1rem; }
        .button-group { display: flex; gap: 20px; justify-content: center; margin: 30px 0; flex-wrap: wrap; }
        button { padding: 15px 30px; font-size: 1rem; font-weight: bold; border: none; border-radius: 8px; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; gap: 10px; }
        .copy-btn { background: #10b981; color: white; }
        .copy-btn:hover { background: #059669; transform: translateY(-2px); box-shadow: 0 5px 15px rgba(16, 185, 129, 0.4); }
        .download-btn { background: #3b82f6; color: white; }
        .download-btn:hover { background: #2563eb; transform: translateY(-2px); box-shadow: 0 5px 15px rgba(59, 130, 246, 0.4); }
        .copied { background: #22d3ee !important; }
        .code-container { background: #1e1e1e; border-radius: 12px; padding: 20px; margin: 30px 0; border: 1px solid #333; position: relative; }
        .code-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid #333; }
        .code-title { color: #22d3ee; font-family: 'Consolas', 'Monaco', monospace; font-size: 0.9rem; }
        .line-count { color: #666; font-size: 0.85rem; }
        pre { margin: 0; overflow-x: auto; font-family: 'Consolas', 'Monaco', 'Courier New', monospace; font-size: 0.9rem; line-height: 1.5; max-height: 500px; overflow-y: auto; }
        code { color: #e0e0e0; }
        .instructions { background: #2a2a3e; border-left: 4px solid #22d3ee; padding: 25px; border-radius: 8px; margin: 30px 0; }
        .instructions h2 { color: #22d3ee; margin-bottom: 15px; font-size: 1.5rem; }
        .instructions ol { margin-left: 20px; }
        .instructions li { margin: 10px 0; padding-left: 10px; }
        .warning { background: #3a2a1a; border-left: 4px solid #f59e0b; padding: 20px; border-radius: 8px; margin: 20px 0; }
        .warning-title { color: #f59e0b; font-weight: bold; margin-bottom: 10px; }
        .requirements { background: #1a2a3a; padding: 20px; border-radius: 8px; margin: 20px 0; }
        .requirements h3 { color: #22d3ee; margin-bottom: 15px; }
        .requirements ul { list-style: none; margin-left: 0; }
        .requirements li:before { content: "‚úì "; color: #10b981; font-weight: bold; margin-right: 8px; }
        footer { text-align: center; margin-top: 50px; padding-top: 30px; border-top: 1px solid #333; color: #666; }
        footer a { color: #22d3ee; text-decoration: none; }
        footer a:hover { text-decoration: underline; }
        @media (max-width: 768px) { h1 { font-size: 1.8rem; } .button-group { flex-direction: column; } button { width: 100%; justify-content: center; } }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üîê IIIT-H VPN Setup for macOS</h1>
            <p class="subtitle">Automated script for macOS 10.15+ (Intel & Apple Silicon)</p>
        </header>

        <div class="button-group">
            <button class="copy-btn" onclick="copyScript()">
                <span id="copy-icon">üìã</span>
                <span id="copy-text">Copy Script</span>
            </button>
            <button class="download-btn" onclick="downloadScript()">
                üíæ Download Script (.sh)
            </button>
        </div>

        <div class="code-container">
            <div class="code-header">
                <span class="code-title">setup-vpn-macos.sh</span>
                <span class="line-count">Lines: 1-155</span>
            </div>
            <pre><code id="script-content">#!/bin/bash

# IIIT Hyderabad VPN Setup Script for macOS
# Compatible with: macOS 10.15+ (Catalina and later), Intel & Apple Silicon
# Author: OSDG Club, IIIT Hyderabad
# Last Updated: October 2025

set -e

# Colors
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
CYAN='\033[0;36m'
NC='\033[0m' # No Color

# Configuration
OVPN_CONFIG_PATH="$HOME/Downloads/macos.ovpn"
OPENVPN_APP="/Applications/OpenVPN Connect.app"
OPENVPN_CLI="$OPENVPN_APP/Contents/MacOS/OpenVPN Connect"
OPENVPN_DMG_URL="https://openvpn.net/downloads/openvpn-connect-v3-macos.dmg"
TEMP_DMG="$HOME/Downloads/openvpn-connect-temp.dmg"

echo -e "${CYAN}=========================================${NC}"
echo -e "${CYAN}  IIIT Hyderabad VPN Setup - macOS${NC}"
echo -e "${CYAN}=========================================${NC}"
echo ""

# Function to check internet connectivity
check_internet() {
    if ! ping -c 1 openvpn.net &> /dev/null; then
        echo -e "${RED}ERROR: No internet connection detected${NC}"
        echo -e "${YELLOW}Please connect to the internet and try again${NC}"
        exit 1
    fi
}

# Check internet connection
echo -e "${YELLOW}[1/5] Checking internet connection...${NC}"
check_internet
echo -e "${GREEN}‚úì Internet connection verified${NC}"
echo ""

# Check if config file exists
echo -e "${YELLOW}[2/5] Checking for VPN configuration file...${NC}"
if [ ! -f "$OVPN_CONFIG_PATH" ]; then
    echo -e "${RED}ERROR: Configuration file not found!${NC}"
    echo -e "${RED}Expected location: $OVPN_CONFIG_PATH${NC}"
    echo ""
    echo -e "${YELLOW}Please:${NC}"
    echo -e "${YELLOW}  1. Download 'macos.ovpn' from the OSDG website${NC}"
    echo -e "${YELLOW}  2. Save it to your Downloads folder${NC}"
    echo -e "${YELLOW}  3. Run this script again${NC}"
    exit 2
fi
echo -e "${GREEN}‚úì Configuration file found${NC}"
echo ""

# Check if Homebrew is installed
check_homebrew() {
    if command -v brew &> /dev/null; then
        return 0
    else
        return 1
    fi
}

# Install Homebrew
install_homebrew() {
    echo -e "${CYAN}  Installing Homebrew...${NC}"
    /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
    
    # Configure PATH for Apple Silicon
    if [[ $(uname -m) == 'arm64' ]]; then
        echo 'eval "$(/opt/homebrew/bin/brew shellenv)"' >> ~/.zprofile
        eval "$(/opt/homebrew/bin/brew shellenv)"
    fi
}

# Install via Homebrew
install_via_homebrew() {
    echo -e "${CYAN}  Installing OpenVPN Connect via Homebrew...${NC}"
    brew install --cask openvpn-connect
}

# Install via direct download
install_via_download() {
    echo -e "${CYAN}  Downloading OpenVPN Connect...${NC}"
    curl -L -o "$TEMP_DMG" "$OPENVPN_DMG_URL"
    
    echo -e "${CYAN}  Mounting installer...${NC}"
    MOUNT_POINT=$(hdiutil attach "$TEMP_DMG" -nobrowse | grep Volumes | awk '{print $3}')
    
    echo -e "${CYAN}  Installing OpenVPN Connect...${NC}"
    cp -R "$MOUNT_POINT/OpenVPN Connect.app" /Applications/
    
    echo -e "${CYAN}  Cleaning up...${NC}"
    hdiutil detach "$MOUNT_POINT" -quiet
    rm "$TEMP_DMG"
}

# Check if OpenVPN Connect is installed
echo -e "${YELLOW}[3/5] Checking OpenVPN Connect installation...${NC}"
if [ -d "$OPENVPN_APP" ]; then
    echo -e "${GREEN}‚úì OpenVPN Connect is already installed${NC}"
else
    echo -e "${YELLOW}OpenVPN Connect not found. Installing...${NC}"
    echo ""
    
    if check_homebrew; then
        # Homebrew exists, use it
        install_via_homebrew
    else
        # Ask user preference
        echo -e "${CYAN}Homebrew not found. Choose installation method:${NC}"
        echo -e "${NC}  1) Install Homebrew first, then install OpenVPN (recommended)${NC}"
        echo -e "${NC}  2) Direct download from OpenVPN.net (no Homebrew needed)${NC}"
        echo ""
        read -p "Enter choice (1 or 2): " choice
        
        case $choice in
            1)
                install_homebrew
                install_via_homebrew
                ;;
            2)
                install_via_download
                ;;
            *)
                echo -e "${YELLOW}Invalid choice. Using direct download...${NC}"
                install_via_download
                ;;
        esac
    fi
    
    # Verify installation
    if [ ! -d "$OPENVPN_APP" ]; then
        echo -e "${RED}ERROR: OpenVPN Connect installation failed${NC}"
        exit 1
    fi
    
    echo -e "${GREEN}  ‚úì OpenVPN Connect installed successfully${NC}"
fi
echo ""

# Verify CLI executable
if [ ! -f "$OPENVPN_CLI" ]; then
    echo -e "${RED}ERROR: OpenVPN Connect CLI not found at expected location${NC}"
    echo -e "${YELLOW}Please install OpenVPN Connect manually from:${NC}"
    echo -e "${YELLOW}  https://openvpn.net/client-connect-vpn-for-mac-os/${NC}"
    exit 1
fi

# Accept GDPR consent
echo -e "${YELLOW}[4/5] Configuring OpenVPN Connect...${NC}"
"$OPENVPN_CLI" --accept-gdpr 2>/dev/null || echo -e "${YELLOW}  GDPR consent may have already been accepted${NC}"
echo -e "${GREEN}‚úì Configuration accepted${NC}"
echo ""

# Import VPN profile
echo -e "${YELLOW}[5/5] Importing VPN configuration...${NC}"
"$OPENVPN_CLI" --import-profile="$OVPN_CONFIG_PATH"
sleep 2
echo -e "${GREEN}‚úì VPN profile imported successfully${NC}"
echo ""

# Configure auto-connect (optional)
echo -e "${CYAN}Configuring auto-connect on launch...${NC}"
"$OPENVPN_CLI" --set-setting=launch-options --value=connect-latest 2>/dev/null || true

echo ""
echo -e "${GREEN}=========================================${NC}"
echo -e "${GREEN}  ‚úì VPN SETUP COMPLETE!${NC}"
echo -e "${GREEN}=========================================${NC}"
echo ""
echo -e "${CYAN}NEXT STEPS:${NC}"
echo -e "${NC}  1. OpenVPN Connect will open automatically${NC}"
echo -e "${NC}  2. Click on the IIITH-VPN profile to connect${NC}"
echo -e "${NC}  3. Enter your IIIT Hyderabad credentials:${NC}"
echo -e "${YELLOW}     Username: your-iiith-email@students.iiit.ac.in${NC}"
echo -e "${YELLOW}     Password: your IIIT-H password${NC}"
echo ""
echo -e "${CYAN}USEFUL COMMANDS:${NC}"
echo -e "${NC}  Open OpenVPN:        ${YELLOW}open -a 'OpenVPN Connect'${NC}"
echo -e "${NC}  Import new profile:  ${YELLOW}'$OPENVPN_CLI' --import-profile='path/to/file.ovpn'${NC}"
echo ""
echo -e "${CYAN}Need help? Visit the OSDG website or use our AI chatbot!${NC}"
echo ""

# Open OpenVPN Connect GUI
open -a "OpenVPN Connect" 2>/dev/null || echo -e "${YELLOW}Please open OpenVPN Connect manually from Applications${NC}"</code></pre>
        </div>

        <div class="instructions">
            <h2>üìñ Installation Instructions</h2>
            <ol>
                <li><strong>Download your config file:</strong> Download <code>macos.ovpn</code> from the OSDG VPN page and save it to your Downloads folder</li>
                <li><strong>Copy the script:</strong> Click the "Copy Script" button above</li>
                <li><strong>Open Terminal:</strong> Press <kbd>Cmd + Space</kbd>, type "Terminal", and press <kbd>Enter</kbd></li>
                <li><strong>Paste and run:</strong> Right-click to paste the script, then press <kbd>Enter</kbd></li>
                <li><strong>Follow prompts:</strong> Choose Homebrew or direct download installation method if needed</li>
                <li><strong>Enter IIIT-H credentials:</strong> When OpenVPN Connect opens, click your profile and enter credentials</li>
            </ol>
        </div>

        <div class="warning">
            <div class="warning-title">‚ö†Ô∏è Important Notes</div>
            <ul>
                <li>Ensure <code>macos.ovpn</code> is in your Downloads folder before running</li>
                <li>Internet connection is required for installation</li>
                <li>Script works on both Intel and Apple Silicon Macs</li>
                <li>If you don't have Homebrew, the script offers direct download option</li>
            </ul>
        </div>

        <div class="requirements">
            <h3>‚úÖ Requirements</h3>
            <ul>
                <li>macOS 10.15 (Catalina) or later</li>
                <li>Intel or Apple Silicon Mac</li>
                <li>Active internet connection</li>
                <li>Downloaded <code>macos.ovpn</code> config file</li>
                <li>IIIT Hyderabad student credentials</li>
            </ul>
        </div>

        <footer>
            <p>Having trouble? <a href="/vpn-setup">Use our AI-powered troubleshooting chatbot</a></p>
            <p>¬© 2025 OSDG Club, IIIT Hyderabad</p>
        </footer>
    </div>

    <script>
        function copyScript() {
            const scriptContent = document.getElementById('script-content').textContent;
            const copyBtn = document.querySelector('.copy-btn');
            const copyIcon = document.getElementById('copy-icon');
            const copyText = document.getElementById('copy-text');
            
            navigator.clipboard.writeText(scriptContent).then(() => {
                copyBtn.classList.add('copied');
                copyIcon.textContent = '‚úì';
                copyText.textContent = 'Copied!';
                setTimeout(() => {
                    copyBtn.classList.remove('copied');
                    copyIcon.textContent = 'üìã';
                    copyText.textContent = 'Copy Script';
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy:', err);
                alert('Failed to copy script. Please try again or copy manually.');
            });
        }

        function downloadScript() {
            const scriptContent = document.getElementById('script-content').textContent;
            const blob = new Blob([scriptContent], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'setup-vpn-macos.sh';
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
        }
    </script>
</body>
</html>
