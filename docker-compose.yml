version: '3.8'

networks:
  website_network:
    ipam:
      config:
        - subnet: 172.21.1.0/24

services:
    website:
        build:
            context: .
            dockerfile: Dockerfile
        networks:
            website_network:
                ipv4_address: 172.21.1.2
        ports:
            - "3000:80"
        volumes:
            # Mount the data directory for persistent project storage
            - ./data:/app/data
        environment:
            - NODE_ENV=production
            # CAS Authentication Server
            # Use login-test2.iiit.ac.in for testing (whitelisted)
            # Use login.iiit.ac.in for production (requires osdg.in to be whitelisted)
            - CAS_BASE_URL=https://login-test2.iiit.ac.in/cas
        restart: unless-stopped
        container_name: osdg-web
        tty: true
